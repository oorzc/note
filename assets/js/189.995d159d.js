(window.webpackJsonp=window.webpackJsonp||[]).push([[189],{809:function(s,a,t){"use strict";t.r(a);var n=t(5),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"mysql备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql备份"}},[s._v("#")]),s._v(" mysql备份")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242105_282.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242107_61.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242108_266.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242117_435.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[s._v("创建备份用户 并授权")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242119_620.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[s._v("备份某个数据库\n"),t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242121_400.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242124_813.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242130_107.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242128_584.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[s._v("脚本备份")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###############Basic parameters##########################")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DAY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y%m%d"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("/sbin/ifconfig "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"inet addr"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" -1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v(";}'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("':'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v(";}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"backup"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PASSWD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HostPort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3306"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQLBASE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/mysql/"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DATADIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/db_backup/'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DAY}")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("/usr/bin/which mysql"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQLDUMP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("/usr/bin/which mysqldump"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DATADIR}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("Dump")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MYSQLDUMP}")]),s._v(" --master-data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" --single-transaction  --routines --triggers --events -u"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("}")]),s._v(" -p"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PASSWD}")]),s._v(" -P"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HostPort}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${database}")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DATADIR}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${Environment}")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${database}")]),s._v(".sql\n "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DATADIR}")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${Environment}")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${database}")]),s._v(".sql\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("db")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"SELECT schema_name FROM information_schema.schemata where schema_name not in ('information_schema','sys','performance_schema')\"")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" -u$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" -p$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("PASSWD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" --skip-column-names"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("database")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${db}")]),s._v("\n   Dump\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242136_38.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242139_537.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242148_657.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242149_883.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242149_635.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[s._v("日志分析\n"),t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242152_698.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242154_890.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242156_433.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242156_348.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[s._v("创建用户\n"),t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242158_22.png?imageView2/0/w/880/h/680",alt:""}}),s._v(" "),t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242159_931.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242201_224.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242202_835.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242204_70.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242205_580.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242212_226.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242214_871.png?imageView2/0/w/880/h/680",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://qiniu.sponges.cn/201902242217_177.png?imageView2/0/w/880/h/680",alt:""}})])])}),[],!1,null,null,null);a.default=e.exports}}]);