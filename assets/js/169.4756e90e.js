(window.webpackJsonp=window.webpackJsonp||[]).push([[169],{851:function(s,n,t){"use strict";t.r(n);var a=t(5),r=Object(a.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nodejs安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nodejs安装"}},[s._v("#")]),s._v(" nodejs安装")]),s._v(" "),t("p",[s._v("nvm版本快速切换"),t("br"),s._v("\nnode版本发布非常快，而且多版本共存可能性较大，推荐使用nvm来安装node")]),s._v(" "),t("p",[s._v("cnpm")]),s._v(" "),t("p",[s._v("mac 安装：")]),s._v(" "),t("blockquote",[t("p",[s._v("https://www.jianshu.com/p/04d31f6c22bd")])]),s._v(" "),t("p",[s._v("windows安装"),t("br"),s._v("\nhttps://github.com/coreybutler/nvm-windows/releases"),t("br"),s._v("\n下载 nvm-setup.zip"),t("br"),s._v("\nnvm 不能安装到中文或者有空格的目录")]),s._v(" "),t("p",[s._v("setting.txt"),t("br"),s._v("\nroot: D:\\nodejs\\nvm"),t("br"),s._v("\npath: D:\\nodejs\\nodejs"),t("br"),s._v("\nnode_mirror: https://npm.taobao.org/mirrors/node/"),t("br"),s._v("\nnpm_mirror: https://npm.taobao.org/mirrors/npm/")]),s._v(" "),t("p",[s._v("linux安装"),t("br"),s._v("\n$ curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.6/install.sh | bash")]),s._v(" "),t("p",[s._v("$ echo 'export NVM_DIR=\"$HOME/.nvm\"' >> ~/.zshrc"),t("br"),s._v('\n$ echo \'[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh" # This loads nvm\' >> ~/.zshrc'),t("br"),s._v("\n$ source ~/.zshrc")]),s._v(" "),t("p",[s._v("$ nvm install 0.10"),t("br"),s._v("\n$ nvm install 4"),t("br"),s._v("\n$ nvm install 6"),t("br"),s._v("\n$ nvm install 8")]),s._v(" "),t("p",[s._v("查看node安装路径"),t("br"),s._v("\nwhich node")]),s._v(" "),t("p",[s._v("nvm 设置 nodejs 默认版本"),t("br"),s._v("\nnvm alias default v9.3.0")]),s._v(" "),t("p",[s._v("// 阿里node 性能监控"),t("br"),s._v("\nagenthub start alinode.json & // 启动AgentX"),t("br"),s._v("\nexport ENABLE_NODE_LOG=YES // 当您需要 alinode   的内核级监控时，请于启动进程前，添加如下两个环境变量"),t("br"),s._v("\nexport NODE_LOG_DIR=/tmp/"),t("br"),s._v("\nnode app.js //启动你的node.js 应用。")]),s._v(" "),t("p",[s._v("启动应用"),t("br"),s._v("\nENABLE_NODE_LOG=YES node app.js")]),s._v(" "),t("p",[s._v("https://help.aliyun.com/document_detail/60338.html?spm=a2c4g.11174283.6.548.64df30b1O5iBzL")]),s._v(" "),t("h2",{attrs:{id:"yarn安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yarn安装"}},[s._v("#")]),s._v(" yarn安装")]),s._v(" "),t("p",[s._v("Linux")]),s._v(" "),t("blockquote",[t("p",[s._v("https://yarnpkg.com/lang/en/docs/install/#centos-stable")])]),s._v(" "),t("p",[s._v("MAC")]),s._v(" "),t("p",[s._v("brew install yarn")]),s._v(" "),t("p",[s._v("用 npm 安装 yarn"),t("br"),s._v("\nnpm i -g yarn")]),s._v(" "),t("p",[s._v("yarn config set registry https://registry.npm.taobao.org -g")]),s._v(" "),t("p",[s._v("yarn config set sass_binary_site http://cdn.npm.taobao.org/dist/node-sass -g")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("初始化一个新的项目\nyarn init\n\n添加一个依赖包\nyarn add [package]\nyarn add [package]@[version]\nyarn add [package]@[tag]\n\n更新一个依赖包\nyarn upgrade [package]\nyarn upgrade [package]@[version]\nyarn upgrade [package]@[tag]\n\n删除一个依赖包\nyarn remove [package]\n\n安装所有的依赖包\nyarn  or  yarn install\n\n列出每个缓存的包\nyarn cache ls \n\n清除本地缓存\nyarn cache clean\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h2",{attrs:{id:"pm2进程守护"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2进程守护"}},[s._v("#")]),s._v(" pm2进程守护")]),s._v(" "),t("p",[s._v("安装："),t("br"),s._v("\nnpm install pm2 -g //安装pm2"),t("br"),s._v("\npm2 update // 更新pm2"),t("br"),s._v("\npm2 uninstall pm2 //移除pm2")]),s._v(" "),t("p",[s._v("pm2.json 配置启动信息:")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apps"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mywork"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//应用程序名称")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cwd"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/srv/node-app/current"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//应用程序所在的目录")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"script"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bin/www"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//应用程序的脚本路径")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log_date_format"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YYYY-MM-DD HH:mm Z"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"error_file"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/node-app/node-app.stderr.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//自定义应用程序的错误日志文件")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"out_file"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log/node-app.stdout.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//自定义应用程序日志文件")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid_file"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pids/node-geo-api.pid"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//自定义应用程序的pid文件")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"instances"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//启动的线程数量")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"min_uptime"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//最小运行时间，这里设置的是60s即如果应用程序在60s内退出，pm2会认为程序异常退出，此时触发重启max_restarts设置数量")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"max_restarts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置应用程序异常退出重启的次数，默认15次（从0开始计数）")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"max_memory_restart"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1M"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 最大重启内存")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cron_restart"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1 0 * * *"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//定时启动，解决重启能解决的问题")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//是否启用监控模式，默认是false。如果设置成true，当应用程序变动时，pm2会自动重载。这里也可以设置你要监控的文件。")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ignore_watch"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_modules"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//忽略监听")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"merge_logs"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exec_interpreter"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//应用程序的脚本类型，这里使用的shell，默认是nodejs")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exec_mode"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fork"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//应用程序启动模式，这里设置的是cluster_mode（集群），默认是fork")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"autorestart"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//启用/禁用应用程序崩溃或退出时自动重启")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vizion"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 启用/禁用vizion特性(版本控制)")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("开启关闭："),t("br"),s._v("\npm2 start server.js //启动server.js进程"),t("br"),s._v("\npm2 start server.js -i 4 //启动4个server.js进程"),t("br"),s._v("\npm2 restart server.js //重启server.js进程")]),s._v(" "),t("p",[s._v('pm2 start app.js -i 4         # cluster mode 模式启动4个app.js的应用实例     # 4个应用程序会自动进行负载均衡\npm2 start app.js --name="api" # 启动应用程序并命名为 "api"'),t("br"),s._v("\npm2 start app.js --watch      # 当文件变化时自动重启应用")]),s._v(" "),t("p",[s._v("pm2 stop all // 停止所有进程"),t("br"),s._v("\npm2 stop server.js //停止server.js进程"),t("br"),s._v("\npm2 stop 0 //停止编号为0的进程"),t("br"),s._v("\npm2 restart all               # 重启所有应用"),t("br"),s._v("\npm2 reload all                # 重启 cluster mode下的所有应用"),t("br"),s._v("\npm2 gracefulReload all        # Graceful reload all apps in cluster mode"),t("br"),s._v("\npm2 delete all                # 关闭并删除所有应用"),t("br"),s._v("\npm2 delete 0                  # 删除指定应用 id 0"),t("br"),s._v("\npm2 scale api 10              # 把名字叫api的应用扩展到10个实例"),t("br"),s._v("\npm2 reset [app-name]          # 重置重启数量"),t("br"),s._v("\npm2 startup                   # 创建开机自启动命令"),t("br"),s._v("\npm2 save                      # 保存当前应用列表"),t("br"),s._v("\npm2 resurrect                 # 重新加载保存的应用列表")]),s._v(" "),t("p",[s._v("查看："),t("br"),s._v("\npm2 list //查看当前正在运行的进程"),t("br"),s._v("\npm2 show 0 //查看执行编号为0的进程")]),s._v(" "),t("p",[s._v("实时监控:"),t("br"),s._v("\npm2 monit //监控当前所有的进程"),t("br"),s._v("\npm2 monit 0 //监控批评行编号为0的进程"),t("br"),s._v("\npm2 monit server.js //监控名称为server.js的进程")]),s._v(" "),t("p",[s._v("日志："),t("br"),s._v("\npm2 logs //显示所有日志"),t("br"),s._v("\npm2 logs 0 //显示执行编号为0的日志"),t("br"),s._v("\npm2 logs server.js //显示名称为server.js的进程"),t("br"),s._v("\npm2 flush  //清除所有日志")])])}),[],!1,null,null,null);n.default=r.exports}}]);